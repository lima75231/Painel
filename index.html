<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel de Produção – Hospital São Daniel Comboni</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- (Opcional) Fonte Inter para dar cara de sistema moderno -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --cor-fundo: #eef2f7;
      --cor-card: #ffffff;
      --cor-primaria: #111827;
      --cor-secundaria: #2563eb;
      --cor-secundaria-clara: #dbeafe;
      --cor-texto: #111827;
      --cor-texto-secundario: #4b5563;
      --cor-borda: #e5e7eb;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #e3ebff 0, #eef2f7 35%, #eef2f7 100%);
      color: var(--cor-texto);
      padding: 1.5rem;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Cabeçalho institucional */
    .header-estabelecimento {
      background: linear-gradient(120deg, #111827, #1f2937, #2563eb);
      color: #fff;
      padding: 1.5rem 1.7rem;
      border-radius: 1rem;
      margin-bottom: 1.25rem;
      box-shadow: 0 18px 45px rgba(15,23,42,0.35);
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .header-estabelecimento h1 {
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .header-estabelecimento p {
      font-size: 0.9rem;
      color: #e5e7eb;
    }

    .header-estabelecimento p strong {
      color: #f9fafb;
      font-weight: 600;
    }

    /* Info atualização */
    .info-atualizacao {
      background: #ffffff;
      border: 1px solid var(--cor-borda);
      padding: 0.85rem 1.2rem;
      border-radius: 0.9rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 8px 22px rgba(15,23,42,0.08);
      font-size: 0.9rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem 2rem;
      align-items: center;
      justify-content: space-between;
    }

    .info-atualizacao p {
      margin: 0;
      color: var(--cor-texto-secundario);
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .info-atualizacao strong {
      color: var(--cor-texto);
      font-weight: 600;
    }

    /* Filtros */
    .filtros {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .filtro-card {
      background: var(--cor-card);
      border-radius: 0.85rem;
      padding: 0.85rem 1rem;
      border: 1px solid var(--cor-borda);
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.06);
      transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
    }

    .filtro-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 26px rgba(15,23,42,0.1);
      border-color: #c7d2fe;
    }

    .filtro-card label {
      display: block;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--cor-texto-secundario);
      margin-bottom: 0.35rem;
      font-weight: 600;
    }

    .filtro-card select {
      width: 100%;
      padding: 0.5rem 0.7rem;
      border-radius: 0.6rem;
      border: 1px solid var(--cor-borda);
      font-size: 0.9rem;
      outline: none;
      background: #f9fafb;
      transition: border-color 0.18s ease, background-color 0.18s ease;
    }

    .filtro-card select:focus {
      border-color: var(--cor-secundaria);
      background: #fff;
    }

    /* KPIs */
    .kpis {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
      gap: 1rem;
      margin-bottom: 1.75rem;
    }

    .kpi-card {
      background: var(--cor-card);
      border-radius: 0.95rem;
      padding: 0.85rem 1rem;
      border: 1px solid var(--cor-borda);
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.08);
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      position: relative;
      overflow: hidden;
      transition: transform 0.18s ease, box-shadow 0.18s ease;
    }

    .kpi-card::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: linear-gradient(120deg, rgba(37,99,235,0.08), transparent);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.18s ease;
    }

    .kpi-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 36px rgba(15,23,42,0.12);
    }

    .kpi-card:hover::before {
      opacity: 1;
    }

    .kpi-label {
      font-size: 0.8rem;
      color: var(--cor-texto-secundario);
      font-weight: 500;
    }

    .kpi-valor {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--cor-primaria);
    }

    .kpi-extra {
      font-size: 0.75rem;
      color: var(--cor-texto-secundario);
    }

    /* Gráficos */
    .grid-graficos {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.5fr);
      gap: 1.25rem;
      margin-bottom: 1.5rem;
    }

    .card {
      background: var(--cor-card);
      border-radius: 0.95rem;
      padding: 0.9rem 1rem;
      border: 1px solid var(--cor-borda);
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.08);
      transition: transform 0.18s ease, box-shadow 0.18s ease;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 36px rgba(15,23,42,0.12);
    }

    .card h2 {
      font-size: 1rem;
      margin-bottom: 0.25rem;
      color: var(--cor-primaria);
      font-weight: 600;
    }

    .card p {
      font-size: 0.8rem;
      color: var(--cor-texto-secundario);
      margin-bottom: 0.5rem;
    }

    .card canvas {
      max-height: 280px;
    }

    /* Tabela */
    .tabela-wrapper {
      background: var(--cor-card);
      border-radius: 0.95rem;
      border: 1px solid var(--cor-borda);
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.08);
      padding: 0.9rem 1rem 1rem;
      overflow-x: auto;
      margin-top: 1rem;
    }

    .tabela-wrapper h2 {
      font-size: 0.95rem;
      margin-bottom: 0.4rem;
      color: var(--cor-primaria);
      font-weight: 600;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    thead {
      background: #f9fafb;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    th, td {
      padding: 0.45rem 0.6rem;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
      white-space: nowrap;
    }

    th {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--cor-texto-secundario);
    }

    tbody tr:nth-child(even) {
      background: #f9fafb;
    }

    @media (max-width: 900px) {
      .grid-graficos {
        grid-template-columns: 1fr;
      }

      .info-atualizacao {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>

<div class="container">

  <!-- Cabeçalho -->
  <header class="header-estabelecimento">
    <h1>HOSPITAL SÃO DANIEL COMBONI</h1>
    <p><strong>CNES:</strong> 6926401 • <strong>Município:</strong> Cacoal - RO • <strong>Tipo:</strong> Hospital Geral</p>
    <p>Painel de produção ambulatorial – atendimentos gratuitos por competência.</p>
  </header>

  <!-- Atualização -->
  <div class="info-atualizacao">
    <p><strong>Última atualização:</strong> <span id="dataAtualizacao"></span></p>
    <p><strong>Fonte dos dados:</strong> Planilha local – competências x total de atendimentos gratuitos</p>
  </div>

  <!-- FILTROS -->
  <section class="filtros">
    <div class="filtro-card">
      <label for="filtroAno">Ano de competência</label>
      <select id="filtroAno">
        <option value="todos">Todos</option>
      </select>
    </div>

    <div class="filtro-card">
      <label for="filtroFonte">Fonte de remuneração</label>
      <select id="filtroFonte">
        <option value="todas">Todas</option>
      </select>
    </div>
  </section>

  <!-- KPIs -->
  <section class="kpis">
    <div class="kpi-card">
      <div class="kpi-label">Total de atendimentos (filtro atual)</div>
      <div class="kpi-valor" id="kpiTotal"></div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Anos com produção registrada</div>
      <div class="kpi-valor" id="kpiAnos"></div>
      <div class="kpi-extra">Com base nas competências informadas</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Fontes de remuneração</div>
      <div class="kpi-valor" id="kpiFontes"></div>
      <div class="kpi-extra">Ex.: Gratuito, SUS, convênios (quando houver)</div>
    </div>
  </section>

  <!-- GRÁFICOS -->
  <section class="grid-graficos">
    <div class="card">
      <h2>Produção por ano</h2>
      <p>Total de atendimentos por ano de competência.</p>
      <canvas id="graficoAno"></canvas>
    </div>
    <div class="card">
      <h2>Distribuição por fonte</h2>
      <p>Participação das fontes de remuneração no total produzido.</p>
      <canvas id="graficoFonte"></canvas>
    </div>
  </section>

  <section class="card">
    <h2>Produção mensal (por ano selecionado)</h2>
    <p>Quantitativo de atendimentos por mês, respeitando o filtro de ano.</p>
    <canvas id="graficoMes"></canvas>
  </section>

  <!-- TABELA -->
  <section class="tabela-wrapper">
    <h2>Detalhamento dos registros</h2>
    <table>
      <thead>
        <tr>
          <th>Ano</th>
          <th>Mês</th>
          <th>Fonte</th>
          <th>Quantidade</th>
        </tr>
      </thead>
      <tbody id="tabelaCorpo"></tbody>
    </table>
  </section>

</div>

<script>
  const dados = [
    { ano: 2021, mes: 1, fonte: "Gratuito", quantidade: 1166 },
    { ano: 2021, mes: 2, fonte: "Gratuito", quantidade: 425 },
    { ano: 2021, mes: 3, fonte: "Gratuito", quantidade: 0 },
    { ano: 2021, mes: 4, fonte: "Gratuito", quantidade: 0 },
    { ano: 2021, mes: 5, fonte: "Gratuito", quantidade: 0 },
    { ano: 2021, mes: 6, fonte: "Gratuito", quantidade: 0 },
    { ano: 2021, mes: 7, fonte: "Gratuito", quantidade: 0 },
    { ano: 2021, mes: 8, fonte: "Gratuito", quantidade: 0 },
    { ano: 2021, mes: 9, fonte: "Gratuito", quantidade: 0 },
    { ano: 2021, mes: 10, fonte: "Gratuito", quantidade: 0 },
    { ano: 2021, mes: 11, fonte: "Gratuito", quantidade: 0 },
    { ano: 2021, mes: 12, fonte: "Gratuito", quantidade: 0 },

    { ano: 2022, mes: 1, fonte: "Gratuito", quantidade: 73 },
    { ano: 2022, mes: 2, fonte: "Gratuito", quantidade: 37 },
    { ano: 2022, mes: 3, fonte: "Gratuito", quantidade: 61 },
    { ano: 2022, mes: 4, fonte: "Gratuito", quantidade: 34 },
    { ano: 2022, mes: 5, fonte: "Gratuito", quantidade: 30 },
    { ano: 2022, mes: 6, fonte: "Gratuito", quantidade: 9 },
    { ano: 2022, mes: 7, fonte: "Gratuito", quantidade: 33 },
    { ano: 2022, mes: 8, fonte: "Gratuito", quantidade: 104 },
    { ano: 2022, mes: 9, fonte: "Gratuito", quantidade: 107 },
    { ano: 2022, mes: 10, fonte: "Gratuito", quantidade: 95 },
    { ano: 2022, mes: 11, fonte: "Gratuito", quantidade: 80 },
    { ano: 2022, mes: 12, fonte: "Gratuito", quantidade: 78 },

    { ano: 2023, mes: 5, fonte: "Gratuito", quantidade: 24 },
    { ano: 2023, mes: 6, fonte: "Gratuito", quantidade: 256 },
    { ano: 2023, mes: 7, fonte: "Gratuito", quantidade: 309 },
    { ano: 2023, mes: 9, fonte: "Gratuito", quantidade: 810 },
    { ano: 2023, mes: 10, fonte: "Gratuito", quantidade: 312 },
    { ano: 2023, mes: 11, fonte: "Gratuito", quantidade: 849 },
    { ano: 2023, mes: 12, fonte: "Gratuito", quantidade: 27 },

    { ano: 2024, mes: 1, fonte: "Gratuito", quantidade: 24 },
    { ano: 2024, mes: 2, fonte: "Gratuito", quantidade: 29 },
    { ano: 2024, mes: 3, fonte: "Gratuito", quantidade: 33 },
    { ano: 2024, mes: 4, fonte: "Gratuito", quantidade: 44 },
    { ano: 2024, mes: 5, fonte: "Gratuito", quantidade: 45 },
    { ano: 2024, mes: 6, fonte: "Gratuito", quantidade: 677 },
    { ano: 2024, mes: 7, fonte: "Gratuito", quantidade: 39 },
    { ano: 2024, mes: 8, fonte: "Gratuito", quantidade: 16 },
    { ano: 2024, mes: 9, fonte: "Gratuito", quantidade: 43 },
    { ano: 2024, mes: 10, fonte: "Gratuito", quantidade: 47 },
    { ano: 2024, mes: 11, fonte: "Gratuito", quantidade: 145 },
    { ano: 2024, mes: 12, fonte: "Gratuito", quantidade: 29 },

    { ano: 2025, mes: 1, fonte: "Gratuito", quantidade: 58 },
    { ano: 2025, mes: 2, fonte: "Gratuito", quantidade: 66 },
    { ano: 2025, mes: 3, fonte: "Gratuito", quantidade: 53 },
    { ano: 2025, mes: 4, fonte: "Gratuito", quantidade: 44 },
    { ano: 2025, mes: 5, fonte: "Gratuito", quantidade: 30 },
    { ano: 2025, mes: 6, fonte: "Gratuito", quantidade: 22 },
    { ano: 2025, mes: 7, fonte: "Gratuito", quantidade: 24 },
    { ano: 2025, mes: 8, fonte: "Gratuito", quantidade: 0 },
    { ano: 2025, mes: 9, fonte: "Gratuito", quantidade: 0 },
    { ano: 2025, mes: 10, fonte: "Gratuito", quantidade: 0 }
  ];

  const MESES_LABEL = ["","Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];

  const selectAno = document.getElementById("filtroAno");
  const selectFonte = document.getElementById("filtroFonte");
  const kpiTotal = document.getElementById("kpiTotal");
  const kpiAnos = document.getElementById("kpiAnos");
  const kpiFontes = document.getElementById("kpiFontes");
  const tabelaCorpo = document.getElementById("tabelaCorpo");
  const spanDataAtualizacao = document.getElementById("dataAtualizacao");

  let graficoAno, graficoMes, graficoFonte;

  // Data baseada na última competência
  function atualizarDataDeAtualizacao() {
    if (!dados.length) return;

    const maiorAno = Math.max(...dados.map(d => d.ano));
    const mesesDoAno = dados.filter(d => d.ano === maiorAno).map(d => d.mes);
    const maiorMes = Math.max(...mesesDoAno);

    const mesesExtenso = [
      "", "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
      "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
    ];

    spanDataAtualizacao.textContent = `${mesesExtenso[maiorMes]}/${maiorAno}`;
  }

  function obterAnosUnicos() {
    return [...new Set(dados.map(d => d.ano))].sort();
  }

  function obterFontesUnicas() {
    return [...new Set(dados.map(d => d.fonte))].sort();
  }

  function aplicarFiltros() {
    const ano = selectAno.value;
    const fonte = selectFonte.value;

    return dados.filter(d =>
      (ano === "todos" || d.ano == ano) &&
      (fonte === "todas" || d.fonte === fonte)
    );
  }

  function atualizarKPIs(lista) {
    const total = lista.reduce((s, d) => s + d.quantidade, 0);
    kpiTotal.textContent = total.toLocaleString("pt-BR");
    kpiAnos.textContent = obterAnosUnicos().length;
    kpiFontes.textContent = obterFontesUnicas().length;
  }

  function atualizarTabela(lista) {
    tabelaCorpo.innerHTML = "";
    lista
      .sort((a, b) => a.ano - b.ano || a.mes - b.mes || a.fonte.localeCompare(b.fonte))
      .forEach(d => {
        tabelaCorpo.innerHTML += `
          <tr>
            <td>${d.ano}</td>
            <td>${MESES_LABEL[d.mes]}</td>
            <td>${d.fonte}</td>
            <td>${d.quantidade.toLocaleString("pt-BR")}</td>
          </tr>`;
      });
  }

  function criarGraficoAno(lista) {
    const ctx = document.getElementById("graficoAno").getContext("2d");
    const agrup = {};
    lista.forEach(d => agrup[d.ano] = (agrup[d.ano] || 0) + d.quantidade);

    if (graficoAno) graficoAno.destroy();
    graficoAno = new Chart(ctx, {
      type: "bar",
      data: {
        labels: Object.keys(agrup),
        datasets: [{
          data: Object.values(agrup),
          backgroundColor: "rgba(37, 99, 235, 0.7)",
          borderColor: "rgba(37, 99, 235, 1)",
          borderWidth: 1,
          borderRadius: 6
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
      }
    });
  }

  function criarGraficoFonte(lista) {
    const ctx = document.getElementById("graficoFonte").getContext("2d");
    const agrup = {};
    lista.forEach(d => agrup[d.fonte] = (agrup[d.fonte] || 0) + d.quantidade);

    if (graficoFonte) graficoFonte.destroy();
    graficoFonte = new Chart(ctx, {
      type: "doughnut",
      data: {
        labels: Object.keys(agrup),
        datasets: [{
          data: Object.values(agrup),
          backgroundColor: [
            "rgba(37, 99, 235, 0.8)",
            "rgba(16, 185, 129, 0.8)",
            "rgba(249, 115, 22, 0.8)"
          ]
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: "bottom" }
        }
      }
    });
  }

  function criarGraficoMes(lista, anoFiltro) {
    const ctx = document.getElementById("graficoMes").getContext("2d");
    const agrup = {};

    lista
      .filter(d => anoFiltro === "todos" || d.ano == anoFiltro)
      .forEach(d => agrup[d.mes] = (agrup[d.mes] || 0) + d.quantidade);

    if (graficoMes) graficoMes.destroy();
    graficoMes = new Chart(ctx, {
      type: "line",
      data: {
        labels: Object.keys(agrup).map(m => MESES_LABEL[m]),
        datasets: [{
          data: Object.values(agrup),
          borderColor: "rgba(37, 99, 235, 1)",
          backgroundColor: "rgba(37, 99, 235, 0.1)",
          tension: 0.3,
          fill: true,
          pointRadius: 4,
          pointBackgroundColor: "rgba(37, 99, 235, 1)"
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
      }
    });
  }

  function atualizarPainel() {
    const filtrados = aplicarFiltros();
    const anoSelecionado = selectAno.value;

    atualizarKPIs(filtrados);
    atualizarTabela(filtrados);
    criarGraficoAno(filtrados);
    criarGraficoFonte(filtrados);
    criarGraficoMes(filtrados, anoSelecionado);
  }

  document.addEventListener("DOMContentLoaded", () => {
    atualizarDataDeAtualizacao();

    obterAnosUnicos().forEach(ano => {
      selectAno.innerHTML += `<option value="${ano}">${ano}</option>`;
    });

    obterFontesUnicas().forEach(fonte => {
      selectFonte.innerHTML += `<option value="${fonte}">${fonte}</option>`;
    });

    atualizarPainel();

    selectAno.addEventListener("change", atualizarPainel);
    selectFonte.addEventListener("change", atualizarPainel);
  });
</script>

</body>
</html>
