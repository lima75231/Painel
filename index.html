<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel de Produção – Estabelecimento de Saúde</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --cor-fundo: #f3f4f6;
      --cor-card: #ffffff;
      --cor-primaria: #1f2937;
      --cor-secundaria: #2563eb;
      --cor-texto: #111827;
      --cor-texto-secundario: #4b5563;
      --cor-borda: #e5e7eb;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #e5f0ff 0, #f3f4f6 45%, #f3f4f6 100%);
      color: var(--cor-texto);
      padding: 1.5rem;
    }

    .container { max-width: 1200px; margin: 0 auto; }

    /* Cabeçalho institucional */
    .header-estabelecimento {
      background: linear-gradient(90deg, #1f2937, #374151);
      color: #fff;
      padding: 1.5rem;
      border-radius: 0.75rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    .header-estabelecimento h1 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.3rem;
    }

    .header-estabelecimento p {
      font-size: 0.9rem;
      margin-top: 0.2rem;
      color: #e5e7eb;
    }

    /* Info atualização */
    .info-atualizacao {
      background: #ffffff;
      border: 1px solid #e5e7eb;
      padding: 0.9rem 1.2rem;
      border-radius: 0.75rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.04);
      font-size: 0.9rem;
    }

    .info-atualizacao p { margin: 0.2rem 0; color: #374151; }

    /* Filtros */
    .filtros {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .filtro-card {
      background: var(--cor-card);
      border-radius: 0.75rem;
      padding: 0.85rem 1rem;
      border: 1px solid var(--cor-borda);
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.06);
    }

    .filtro-card label {
      display: block;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--cor-texto-secundario);
      margin-bottom: 0.35rem;
      font-weight: 600;
    }

    .filtro-card select {
      width: 100%;
      padding: 0.45rem 0.6rem;
      border-radius: 0.5rem;
      border: 1px solid var(--cor-borda);
      font-size: 0.9rem;
    }

    /* KPIs */
    .kpis {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .kpi-card {
      background: var(--cor-card);
      border-radius: 0.9rem;
      padding: 0.9rem 1rem;
      border: 1px solid var(--cor-borda);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.07);
    }

    .kpi-label { font-size: 0.8rem; color: var(--cor-texto-secundario); }
    .kpi-valor { font-size: 1.3rem; font-weight: 700; color: var(--cor-primaria); }
    .kpi-extra { font-size: 0.75rem; color: var(--cor-texto-secundario); }

    /* Gráficos */
    .grid-graficos {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.5fr);
      gap: 1.25rem;
      margin-bottom: 1.5rem;
    }

    .card {
      background: var(--cor-card);
      border-radius: 0.9rem;
      padding: 0.9rem 1rem;
      border: 1px solid var(--cor-borda);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.07);
    }

    .card h2 { font-size: 1rem; margin-bottom: 0.4rem; color: var(--cor-primaria); }

    /* Tabela */
    .tabela-wrapper {
      background: var(--cor-card);
      border-radius: 0.9rem;
      padding: 0.9rem 1rem;
      border: 1px solid var(--cor-borda);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.07);
      overflow-x: auto;
    }

    table { width: 100%; border-collapse: collapse; }
    thead { background: #f9fafb; }
    th, td { padding: 0.5rem; border-bottom: 1px solid #e5e7eb; white-space: nowrap; }
    tbody tr:nth-child(even) { background: #f9fafb; }

    @media (max-width: 900px) {
      .grid-graficos { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<div class="container">

  <!-- Cabeçalho -->
  <header class="header-estabelecimento">
    <h1>HOSPITAL SÃO DANIEL COMBONI</h1>
    <p><strong>CNES:</strong> 6926401</p>
    <p><strong>Município:</strong> Cacoal - RO</p>
    <p><strong>Tipo:</strong> Hospital Geral</p>
  </header>

  <!-- Atualização -->
  <div class="info-atualizacao">
    <p><strong>Última atualização:</strong> <span id="dataAtualizacao"></span></p>
    <p><strong>Fonte dos dados:</strong> Planilha local - Competências e atendimentos</p>
  </div>

  <!-- FILTROS -->
  <section class="filtros">
    <div class="filtro-card">
      <label for="filtroAno">Ano</label>
      <select id="filtroAno"><option value="todos">Todos</option></select>
    </div>

    <div class="filtro-card">
      <label for="filtroFonte">Fonte</label>
      <select id="filtroFonte"><option value="todas">Todas</option></select>
    </div>
  </section>

  <!-- KPIs -->
  <section class="kpis">
    <div class="kpi-card">
      <div class="kpi-label">Total (filtro atual)</div>
      <div class="kpi-valor" id="kpiTotal"></div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Anos incluídos</div>
      <div class="kpi-valor" id="kpiAnos"></div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Fontes</div>
      <div class="kpi-valor" id="kpiFontes"></div>
    </div>
  </section>

  <!-- GRÁFICOS -->
  <section class="grid-graficos">
    <div class="card">
      <h2>Produção por Ano</h2>
      <canvas id="graficoAno"></canvas>
    </div>
    <div class="card">
      <h2>Por Fonte</h2>
      <canvas id="graficoFonte"></canvas>
    </div>
  </section>

  <section class="card">
    <h2>Produção Mensal</h2>
    <canvas id="graficoMes"></canvas>
  </section>

  <!-- TABELA -->
  <section class="tabela-wrapper">
    <h2 style="margin-bottom: 0.5rem;">Detalhamento</h2>
    <table>
      <thead>
        <tr><th>Ano</th><th>Mês</th><th>Fonte</th><th>Quantidade</th></tr>
      </thead>
      <tbody id="tabelaCorpo"></tbody>
    </table>
  </section>

</div>

<script>

const dados = [
  { ano: 2021, mes: 1, fonte: "Gratuito", quantidade: 1166 },
  { ano: 2021, mes: 2, fonte: "Gratuito", quantidade: 425 },
  { ano: 2021, mes: 3, fonte: "Gratuito", quantidade: 0 },
  { ano: 2021, mes: 4, fonte: "Gratuito", quantidade: 0 },
  { ano: 2021, mes: 5, fonte: "Gratuito", quantidade: 0 },
  { ano: 2021, mes: 6, fonte: "Gratuito", quantidade: 0 },
  { ano: 2021, mes: 7, fonte: "Gratuito", quantidade: 0 },
  { ano: 2021, mes: 8, fonte: "Gratuito", quantidade: 0 },
  { ano: 2021, mes: 9, fonte: "Gratuito", quantidade: 0 },
  { ano: 2021, mes: 10, fonte: "Gratuito", quantidade: 0 },
  { ano: 2021, mes: 11, fonte: "Gratuito", quantidade: 0 },
  { ano: 2021, mes: 12, fonte: "Gratuito", quantidade: 0 },

  { ano: 2022, mes: 1, fonte: "Gratuito", quantidade: 73 },
  { ano: 2022, mes: 2, fonte: "Gratuito", quantidade: 37 },
  { ano: 2022, mes: 3, fonte: "Gratuito", quantidade: 61 },
  { ano: 2022, mes: 4, fonte: "Gratuito", quantidade: 34 },
  { ano: 2022, mes: 5, fonte: "Gratuito", quantidade: 30 },
  { ano: 2022, mes: 6, fonte: "Gratuito", quantidade: 9 },
  { ano: 2022, mes: 7, fonte: "Gratuito", quantidade: 33 },
  { ano: 2022, mes: 8, fonte: "Gratuito", quantidade: 104 },
  { ano: 2022, mes: 9, fonte: "Gratuito", quantidade: 107 },
  { ano: 2022, mes: 10, fonte: "Gratuito", quantidade: 95 },
  { ano: 2022, mes: 11, fonte: "Gratuito", quantidade: 80 },
  { ano: 2022, mes: 12, fonte: "Gratuito", quantidade: 78 },

  { ano: 2023, mes: 5, fonte: "Gratuito", quantidade: 24 },
  { ano: 2023, mes: 6, fonte: "Gratuito", quantidade: 256 },
  { ano: 2023, mes: 7, fonte: "Gratuito", quantidade: 309 },
  { ano: 2023, mes: 9, fonte: "Gratuito", quantidade: 810 },
  { ano: 2023, mes: 10, fonte: "Gratuito", quantidade: 312 },
  { ano: 2023, mes: 11, fonte: "Gratuito", quantidade: 849 },
  { ano: 2023, mes: 12, fonte: "Gratuito", quantidade: 27 },

  { ano: 2024, mes: 1, fonte: "Gratuito", quantidade: 24 },
  { ano: 2024, mes: 2, fonte: "Gratuito", quantidade: 29 },
  { ano: 2024, mes: 3, fonte: "Gratuito", quantidade: 33 },
  { ano: 2024, mes: 4, fonte: "Gratuito", quantidade: 44 },
  { ano: 2024, mes: 5, fonte: "Gratuito", quantidade: 45 },
  { ano: 2024, mes: 6, fonte: "Gratuito", quantidade: 677 },
  { ano: 2024, mes: 7, fonte: "Gratuito", quantidade: 39 },
  { ano: 2024, mes: 8, fonte: "Gratuito", quantidade: 16 },
  { ano: 2024, mes: 9, fonte: "Gratuito", quantidade: 43 },
  { ano: 2024, mes: 10, fonte: "Gratuito", quantidade: 47 },
  { ano: 2024, mes: 11, fonte: "Gratuito", quantidade: 145 },
  { ano: 2024, mes: 12, fonte: "Gratuito", quantidade: 29 },

  { ano: 2025, mes: 1, fonte: "Gratuito", quantidade: 58 },
  { ano: 2025, mes: 2, fonte: "Gratuito", quantidade: 66 },
  { ano: 2025, mes: 3, fonte: "Gratuito", quantidade: 53 },
  { ano: 2025, mes: 4, fonte: "Gratuito", quantidade: 44 },
  { ano: 2025, mes: 5, fonte: "Gratuito", quantidade: 30 },
  { ano: 2025, mes: 6, fonte: "Gratuito", quantidade: 22 },
  { ano: 2025, mes: 7, fonte: "Gratuito", quantidade: 24 },
  { ano: 2025, mes: 8, fonte: "Gratuito", quantidade: 0 },
  { ano: 2025, mes: 9, fonte: "Gratuito", quantidade: 0 },
  { ano: 2025, mes: 10, fonte: "Gratuito", quantidade: 0 },
];

const MESES_LABEL = ["","Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];

const selectAno = document.getElementById("filtroAno");
const selectFonte = document.getElementById("filtroFonte");
const kpiTotal = document.getElementById("kpiTotal");
const kpiAnos = document.getElementById("kpiAnos");
const kpiFontes = document.getElementById("kpiFontes");
const tabelaCorpo = document.getElementById("tabelaCorpo");
const spanDataAtualizacao = document.getElementById("dataAtualizacao");

let graficoAno, graficoMes, graficoFonte;

// ==== DATA BASEADA NA ÚLTIMA COMPETÊNCIA ====
function atualizarDataDeAtualizacao() {
  if (!dados.length) return;

  const maiorAno = Math.max(...dados.map(d => d.ano));
  const mesesDoAno = dados.filter(d => d.ano === maiorAno).map(d => d.mes);
  const maiorMes = Math.max(...mesesDoAno);

  const mesesExtenso = ["", "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
                        "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];

  spanDataAtualizacao.textContent = `${mesesExtenso[maiorMes]}/${maiorAno}`;
}

function obterAnosUnicos() {
  return [...new Set(dados.map(d => d.ano))].sort();
}

function obterFontesUnicas() {
  return [...new Set(dados.map(d => d.fonte))];
}

function aplicarFiltros() {
  const ano = selectAno.value;
  const fonte = selectFonte.value;

  return dados.filter(d =>
    (ano === "todos" || d.ano == ano) &&
    (fonte === "todas" || d.fonte === fonte)
  );
}

function atualizarKPIs(lista) {
  kpiTotal.textContent = lista.reduce((s, d) => s + d.quantidade, 0);
  kpiAnos.textContent = obterAnosUnicos().length;
  kpiFontes.textContent = obterFontesUnicas().length;
}

function atualizarTabela(lista) {
  tabelaCorpo.innerHTML = "";
  lista.forEach(d => {
    tabelaCorpo.innerHTML += `
      <tr>
        <td>${d.ano}</td>
        <td>${MESES_LABEL[d.mes]}</td>
        <td>${d.fonte}</td>
        <td>${d.quantidade}</td>
      </tr>`;
  });
}

function criarGraficoAno(lista) {
  const ctx = document.getElementById("graficoAno").getContext("2d");
  const agrup = {};

  lista.forEach(d => agrup[d.ano] = (agrup[d.ano] || 0) + d.quantidade);

  if (graficoAno) graficoAno.destroy();
  graficoAno = new Chart(ctx, {
    type: "bar",
    data: {
      labels: Object.keys(agrup),
      datasets: [{
        data: Object.values(agrup),
        backgroundColor: "rgba(37,99,235,0.7)"
      }]
    }
  });
}

function criarGraficoFonte(lista) {
  const ctx = document.getElementById("graficoFonte").getContext("2d");
  const agrup = {};

  lista.forEach(d => agrup[d.fonte] = (agrup[d.fonte] || 0) + d.quantidade);

  if (graficoFonte) graficoFonte.destroy();
  graficoFonte = new Chart(ctx, {
    type: "doughnut",
    data: {
      labels: Object.keys(agrup),
      datasets: [{
        data: Object.values(agrup),
        backgroundColor: ["rgba(37,99,235,0.8)", "rgba(16,185,129,0.8)"]
      }]
    }
  });
}

function criarGraficoMes(lista, anoFiltro) {
  const ctx = document.getElementById("graficoMes").getContext("2d");
  const agrup = {};

  lista
    .filter(d => anoFiltro === "todos" || d.ano == anoFiltro)
    .forEach(d => agrup[d.mes] = (agrup[d.mes] || 0) + d.quantidade);

  if (graficoMes) graficoMes.destroy();
  graficoMes = new Chart(ctx, {
    type: "line",
    data: {
      labels: Object.keys(agrup).map(m => MESES_LABEL[m]),
      datasets: [{
        data: Object.values(agrup),
        borderColor: "rgba(37,99,235,1)",
        tension: 0.3
      }]
    }
  });
}

function atualizarPainel() {
  const filtrados = aplicarFiltros();
  const anoSelecionado = selectAno.value;

  atualizarKPIs(filtrados);
  atualizarTabela(filtrados);
  criarGraficoAno(filtrados);
  criarGraficoFonte(filtrados);
  criarGraficoMes(filtrados, anoSelecionado);
}

document.addEventListener("DOMContentLoaded", () => {
  atualizarDataDeAtualizacao();

  obterAnosUnicos().forEach(a => {
    selectAno.innerHTML += `<option value="${a}">${a}</option>`;
  });

  obterFontesUnicas().forEach(f => {
    selectFonte.innerHTML += `<option value="${f}">${f}</option>`;
  });

  atualizarPainel();

  selectAno.addEventListener("change", atualizarPainel);
  selectFonte.addEventListener("change", atualizarPainel);
});

</script>
</body>
</html>
